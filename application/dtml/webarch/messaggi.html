<!-- MESSAGGI -->
<section id="messaggi">
  <div class="page-content">
    <div class="content">

      <!-- TITOLO PAGINA -->
      <div class="page-title">
        <h3>Messaggi</h3>
      </div>

      <!-- MESSAGGIO DI ESITO -->
      <div><[messaggio_form]></div>

      <!-- FORM DI RICERCA -->
      <div class="row spacing-bottom">
        <div class="col-md-6">
          <form id="search-form" class="form-inline" onsubmit="return false;">
            <div class="form-group">
              <label for="search-input">Cerca messaggi:</label>
              <input type="text" class="form-control" id="search-input" placeholder="Cerca per cliente, oggetto...">
            </div>
            <button type="submit" class="btn btn-primary" id="search-button">Cerca</button>
          </form>
        </div>
      </div>

      <!-- TABELLA CONVERSAZIONI -->
      <div class="row spacing-bottom">
        <div class="col-md-12">
          <div class="panel">
            <div class="panel-body">
              <table class="table table-bordered table-striped table-hover" id="message-table">
                <thead>
                  <tr>
                    <th>Data</th>
                    <th>Cliente</th>
                    <th>Oggetto</th>
                    <th>Ultimo Messaggio</th>
                    <th>Azioni</th>
                  </tr>
                </thead>
                <tbody>
                  <[lista_messaggi]>
                  <!-- Esempio:
                  <tr>
                    <td>03/06/2025 14:20</td>
                    <td>Giulia Bianchi</td>
                    <td>Prenotazione Appuntamento</td>
                    <td>Buongiorno, vorrei confermare la data...</td>
                    <td>
                      <a href="index.php?page=messaggi&action=view&id=27" class="btn btn-primary btn-xs">Apri</a>
                      <a href="index.php?page=messaggi&action=delete&id=27" class="btn btn-danger btn-xs"
                         onclick="return confirm('Eliminare questa conversazione?');">Elimina</a>
                    </td>
                  </tr>
                  -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- AREA DETTAGLIO THREAD -->
      <div class="row">
        <div class="col-md-12">
          <div class="panel">
            <div class="panel-body">
              <div><[messaggio_seleziona_thread]></div>
              <div id="dettaglio-thread">
                <[dettaglio_thread]>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</section>

<!-- SCRIPT PER FILTRARE I MESSAGGI -->
<script>
  document.getElementById('search-button').addEventListener('click', function () {
    const searchValue = document.getElementById('search-input').value.toLowerCase();
    const rows = document.querySelectorAll('#message-table tbody tr');

    rows.forEach(row => {
      const text = row.innerText.toLowerCase();
      row.style.display = text.includes(searchValue) ? '' : 'none';
    });
  });

  // Opzionale: filtraggio in tempo reale durante la digitazione
  document.getElementById('search-input').addEventListener('input', function () {
    document.getElementById('search-button').click();
  });
</script>